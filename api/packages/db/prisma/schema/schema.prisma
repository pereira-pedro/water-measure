generator client {
    provider      = "prisma-client-js"
    engineType    = "binary"
    binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model Address {
    id     String @id @default(uuid()) @db.Uuid
    userId String @map("user_id") @db.Uuid

    street        String
    neighbourhood String
    city          String
    state         String
    country       String

    latitude  Decimal? @db.Decimal(10, 7)
    longitude Decimal? @db.Decimal(10, 7)

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    waterMeters WaterMeter[]

    @@index([userId], map: "idx_addresses_user_id")
    @@map("addresses")
}

model User {
  id        String   @id @default(uuid()) @db.Uuid
  fullName  String   @map("full_name")
  email     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  addresses   Address[]
  waterMeters WaterMeter[]

  @@map("users")
}

model WaterMeterMeasure {
  id               String   @id @default(uuid()) @db.Uuid
  waterMeterId     String   @db.Uuid @map("water_meter_id")

  collectedCounter BigInt   @map("collected_counter")
  collectedAt      DateTime @map("collected_at")

  waterMeter       WaterMeter @relation(fields: [waterMeterId], references: [id], onDelete: Cascade)

  @@index([waterMeterId], map: "idx_water_meter_measures_water_meter_id")
  @@index([collectedAt], map: "idx_water_meter_measures_collected_at")
  @@map("water_meter_measures")
}

model WaterMeter {
  id                 String   @id @default(uuid()) @db.Uuid
  userId             String   @db.Uuid @map("user_id")
  addressId          String   @db.Uuid @map("address_id")

  registrationNumber String   @map("registration_number")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  address            Address  @relation(fields: [addressId], references: [id], onDelete: Cascade)
  measures           WaterMeterMeasure[]

  @@unique([registrationNumber], map: "uq_water_meters_registration_number")
  @@index([userId], map: "idx_water_meters_user_id")
  @@index([addressId], map: "idx_water_meters_address_id")
  @@map("water_meters")
}
